<!-- <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Proofreading</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        ul { list-style-type: none; padding: 0; }
        li { margin: 5px 0; }
        a { color: #007bff; text-decoration: none; cursor: pointer; }
        a:hover { text-decoration: underline; }
        .folder-section { margin-bottom: 20px; }
        .file-list { display: none; margin-left: 20px; }
        pre, textarea {
            width: 100%;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #ccc;
            padding: 10px;
            font-family: monospace;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        button[disabled] {
            background-color: #ccc;
            cursor: not-allowed;
        }
        button {
            margin-top: 10px;
            padding: 8px 12px;
            background-color: #007bff;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <h1>Proofreading Folders</h1>
    <p>Select a folder to view its Markdown files. Click a file to see and edit its content. Once you edit, click "Request Changes" to go to GitHub.</p>
    <div id="folder-list"></div>
    <div id="file-content"></div>

    <script>
        const repoOwner = 'KarthikeyaTirlangi';  // Replace with your GitHub username
        const repoName = 'TrailOCR';       // Replace with your repository name
        const branch = 'main';

        const folderList = document.getElementById('folder-list');
        const fileContent = document.getElementById('file-content');
        let currentFilePath = '';
        let originalContent = '';

        fetch(`https://api.github.com/repos/${repoOwner}/${repoName}/contents?ref=${branch}`)
            .then(response => response.json())
            .then(data => {
                data.forEach(item => {
                    if (item.type === 'dir') {
                        const section = document.createElement('div');
                        section.className = 'folder-section';

                        const title = document.createElement('h2');
                        title.textContent = item.name;
                        title.style.cursor = 'pointer';
                        title.onclick = () => {
                            const list = document.getElementById(`${item.name}-files`);
                            list.style.display = list.style.display === 'none' ? 'block' : 'none';
                        };

                        const ul = document.createElement('ul');
                        ul.id = `${item.name}-files`;
                        ul.className = 'file-list';

                        section.appendChild(title);
                        section.appendChild(ul);
                        folderList.appendChild(section);

                        loadFiles(item.path, ul);
                    }
                });
            })
            .catch(error => console.error('Error fetching folders:', error));

        function loadFiles(folderPath, ul) {
            fetch(`https://api.github.com/repos/${repoOwner}/${repoName}/contents/${folderPath}?ref=${branch}`)
                .then(response => response.json())
                .then(data => {
                    data.forEach(file => {
                        if (file.type === 'file' && file.name.endsWith('.md')) {
                            const li = document.createElement('li');
                            const a = document.createElement('a');
                            a.textContent = file.name;
                            a.onclick = () => loadFile(file.path);
                            li.appendChild(a);
                            ul.appendChild(li);
                        }
                    });
                })
                .catch(error => console.error(`Error fetching files in ${folderPath}:`, error));
        }

        function loadFile(path) {
            const rawUrl = `https://raw.githubusercontent.com/${repoOwner}/${repoName}/${branch}/${path}`;
            fetch(rawUrl)
                .then(response => response.text())
                .then(text => {
                    originalContent = text;
                    currentFilePath = path;

                    fileContent.innerHTML = `
                        <h3>${path}</h3>
                        <textarea id="editor" rows="20">${text}</textarea>
                        <br>
                        <button id="requestChangesBtn" disabled>Request Changes</button>
                    `;

                    const editor = document.getElementById('editor');
                    const btn = document.getElementById('requestChangesBtn');

                    editor.addEventListener('input', () => {
                        btn.disabled = editor.value === originalContent;
                    });

                    btn.onclick = () => {
                        const editUrl = `https://github.com/${repoOwner}/${repoName}/edit/${branch}/${currentFilePath}`;
                        window.open(editUrl, '_blank');
                    };
                })
                .catch(error => {
                    fileContent.innerHTML = `<p>Error loading file: ${error.message}</p>`;
                });
        }
    </script>
</body>
</html> -->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Proofreading</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.9.359/pdf.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        ul { list-style-type: none; padding: 0; }
        li { margin: 5px 0; }
        a { color: #007bff; text-decoration: none; cursor: pointer; }
        a:hover { text-decoration: underline; }
        .folder-section { margin-bottom: 20px; }
        .file-list { display: none; margin-left: 20px; }
        pre, textarea {
            width: 100%;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #ccc;
            padding: 10px;
            font-family: monospace;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        button[disabled] {
            background-color: #ccc;
            cursor: not-allowed;
        }
        button {
            margin-top: 10px;
            padding: 8px 12px;
            background-color: #007bff;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 4px;
        }
        #pdf-viewer {
            margin-top: 10px;
            text-align: center;
        }
        #pdf-canvas {
            border: 1px solid #ccc;
            max-width: 100%;
        }
        #pdf-controls {
            margin-top: 10px;
        }
        .container {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        .editor-section, .pdf-section {
            flex: 1;
            min-width: 300px;
        }
        .info-message {
            font-style: italic;
            color: #555;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <h1>Proofreading Folders</h1>
    <p>Select a folder to view its Markdown and PDF files. Click a file to see its content.</p>
    <p class="info-message">Click a Markdown file to edit its content and view a related PDF for reference. Use "Request Changes" to submit edits to GitHub. Alternatively, click a PDF file to view it independently.</p>
    <div id="folder-list"></div>
    <div id="file-content"></div>

    <script>
        const repoOwner = 'KarthikeyaTirlangi';
        const repoName = 'TrailOCR';
        const branch = 'main';

        const folderList = document.getElementById('folder-list');
        const fileContent = document.getElementById('file-content');
        let currentFilePath = '';
        let originalContent = '';
        let pdfDoc = null;
        let currentPage = 1;
        let totalPages = 0;
        let pdfFilesInFolder = [];

        fetch(`https://api.github.com/repos/${repoOwner}/${repoName}/contents?ref=${branch}`)
            .then(response => response.json())
            .then(data => {
                data.forEach(item => {
                    if (item.type === 'dir') {
                        const section = document.createElement('div');
                        section.className = 'folder-section';

                        const title = document.createElement('h2');
                        title.textContent = item.name;
                        title.style.cursor = 'pointer';
                        title.onclick = () => {
                            const list = document.getElementById(`${item.name}-files`);
                            list.style.display = list.style.display === 'none' ? 'block' : 'none';
                        };

                        const ul = document.createElement('ul');
                        ul.id = `${item.name}-files`;
                        ul.className = 'file-list';

                        section.appendChild(title);
                        section.appendChild(ul);
                        folderList.appendChild(section);

                        loadFiles(item.path, ul);
                    }
                });
            })
            .catch(error => console.error('Error fetching folders:', error));

        function loadFiles(folderPath, ul) {
            fetch(`https://api.github.com/repos/${repoOwner}/${repoName}/contents/${folderPath}?ref=${branch}`)
                .then(response => response.json())
                .then(data => {
                    pdfFilesInFolder = [];
                    data.forEach(file => {
                        if (file.type === 'file' && (file.name.endsWith('.md') || file.name.endsWith('.pdf'))) {
                            const li = document.createElement('li');
                            const a = document.createElement('a');
                            a.textContent = file.name;
                            a.onclick = () => {
                                if (file.name.endsWith('.md')) {
                                    loadMarkdownFile(file.path, folderPath);
                                } else if (file.name.endsWith('.pdf')) {
                                    loadPDFFile(file.path);
                                }
                            };
                            li.appendChild(a);
                            ul.appendChild(li);

                            if (file.name.endsWith('.pdf')) {
                                pdfFilesInFolder.push({ name: file.name, path: file.path });
                            }
                        }
                    });
                })
                .catch(error => console.error(`Error fetching files in ${folderPath}:`, error));
        }

        function loadMarkdownFile(path, folderPath) {
            const rawUrl = `https://raw.githubusercontent.com/${repoOwner}/${repoName}/${branch}/${path}`;
            fetch(rawUrl)
                .then(response => response.text())
                .then(text => {
                    originalContent = text;
                    currentFilePath = path;

                    let pdfSection = '';
                    if (pdfFilesInFolder.length > 0) {
                        pdfSection = `
                            <div class="pdf-section">
                                <h3>Reference PDF</h3>
                                <select id="pdf-selector">
                                    ${pdfFilesInFolder.map(file => `<option value="${file.path}">${file.name}</option>`).join('')}
                                </select>
                                <div id="pdf-viewer">
                                    <canvas id="pdf-canvas"></canvas>
                                    <div id="pdf-controls">
                                        <button id="prev-page" disabled>Previous</button>
                                        <span id="page-info">Page 1 of 1</span>
                                        <button id="next-page" disabled>Next</button>
                                    </div>
                                </div>
                            </div>
                        `;
                    } else {
                        pdfSection = `<div class="pdf-section"><p>No PDFs available in this folder for reference.</p></div>`;
                    }

                    fileContent.innerHTML = `
                        <div class="container">
                            <div class="editor-section">
                                <h3>${path}</h3>
                                <textarea id="editor" rows="20">${text}</textarea>
                                <br>
                                <button id="requestChangesBtn" disabled>Request Changes</button>
                            </div>
                            ${pdfSection}
                        </div>
                    `;

                    const editor = document.getElementById('editor');
                    const btn = document.getElementById('requestChangesBtn');

                    editor.addEventListener('input', () => {
                        btn.disabled = editor.value === originalContent;
                    });

                    btn.onclick = () => {
                        const editUrl = `https://github.com/${repoOwner}/${repoName}/edit/${branch}/${currentFilePath}`;
                        window.open(editUrl, '_blank');
                    });

                    if (pdfFilesInFolder.length > 0) {
                        const pdfSelector = document.getElementById('pdf-selector');
                        pdfSelector.addEventListener('change', () => {
                            loadPDF(pdfSelector.value);
                        });
                        loadPDF(pdfFilesInFolder[0].path);
                    }
                })
                .catch(error => {
                    fileContent.innerHTML = `<p>Error loading file: ${error.message}</p>`;
                });
        }

        function loadPDFFile(path) {
            const pdfUrl = `https://raw.githubusercontent.com/${repoOwner}/${repoName}/${branch}/${path}`;
            fileContent.innerHTML = `
                <h3>${path}</h3>
                <div id="pdf-viewer">
                    <canvas id="pdf-canvas"></canvas>
                    <div id="pdf-controls">
                        <button id="prev-page" disabled>Previous</button>
                        <span id="page-info">Page 1 of 1</span>
                        <button id="next-page" disabled>Next</button>
                    </div>
                </div>
            `;
            loadPDF(pdfUrl);
        }

        function loadPDF(pdfUrl) {
            const loadingTask = pdfjsLib.getDocument(pdfUrl);
            loadingTask.promise.then(pdf => {
                pdfDoc = pdf;
                totalPages = pdf.numPages;
                currentPage = 1;

                const pageInfo = document.getElementById('page-info');
                pageInfo.textContent = `Page ${currentPage} of ${totalPages}`;

                const prevBtn = document.getElementById('prev-page');
                const nextBtn = document.getElementById('next-page');
                prevBtn.disabled = currentPage === 1;
                nextBtn.disabled = currentPage === totalPages;

                prevBtn.onclick = () => {
                    if (currentPage > 1) {
                        currentPage--;
                        renderPDFPage();
                    }
                };
                nextBtn.onclick = () => {
                    if (currentPage < totalPages) {
                        currentPage++;
                        renderPDFPage();
                    }
                };

                renderPDFPage();
            }).catch(error => {
                const pdfViewer = document.getElementById('pdf-viewer');
                if (pdfViewer) {
                    pdfViewer.innerHTML = `<p>Error loading PDF: ${error.message}</p>`;
                }
            });
        }

        function renderPDFPage() {
            pdfDoc.getPage(currentPage).then(page => {
                const canvas = document.getElementById('pdf-canvas');
                const context = canvas.getContext('2d');
                const viewport = page.getViewport({ scale: 1.0 });

                canvas.height = viewport.height;
                canvas.width = viewport.width;

                const renderContext = {
                    canvasContext: context,
                    viewport: viewport
                };
                page.render(renderContext);

                const pageInfo = document.getElementById('page-info');
                pageInfo.textContent = `Page ${currentPage} of ${totalPages}`;

                const prevBtn = document.getElementById('prev-page');
                const nextBtn = document.getElementById('next-page');
                prevBtn.disabled = currentPage === 1;
                nextBtn.disabled = currentPage === totalPages;
            });
        }
    </script>
</body>
</html>
